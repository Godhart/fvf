# Описние тестов

Описание тестов осуществляется в виде модулей Python. 

Модули помещаются во вложенные пакеты внутри пакета `platforms_tests` если тест относится к проверке какой либо сущности
или `ip_tests` если тест относится к проверке интерфейса и протокола. 

Имя вложеннного пакета должно соответствовать типу проверяемой сущнсти или проверяемому интерфейсу.

Внутри модуля должен быть описан класс `RootTest`, имеющий следующие методы и свойства:
* метод `__init__(self, env)`. Параметр env - ссылка на объект тестового окружения, в котором будет проводится проверка
(объект - экземпляр класса TestEnv)
* свойство (`@property`) `tests`, возвращающее перечень тестов

## Перечень тестов

Перечень тестов это список (`list`) структур в виде словаря (`dict`), описывающих каждый из тестов.
При выполнении проверки тесты, если не указано другое, выполняются в порядке их описания в перечне.

Описание каждого теста - это словарь со следующим содержимым:
* `name` - имя теста, строка. Присваивает тесту имя, с которым будут вноситься результаты теста в итоговую таблицу
 проверки, а так же для использования при выводе сообщений
* `f` - ссылка на функцию объекта с описанием тестов, осуществляющую данный тест (функция тестирования)
* `args` - список значений перечислымых аргументов для вызова функции тестирования
* `kwargs` - словарь значений именованных аргументов для вызова фукнции тестирования

## Функция тестирования

В функции тестирования описывается выполнение алгоритма проверки, включающего взаимодействие с объектами тестового
 окружения.

Предлагаемый на данный момент механизм взаимодейстия выглядит следуюзим образом:

На каждое взаимодействие с объектами тестового окружения вызывается метод `transaction` объекта тестового окружения `env`,
ссылка на который была передаётся в конструкторе объекта класса RootTest.

В аргументе указывается канал соощений, в который передаётся запрос, имя интерфейса и вызываемого метода, параметры
 вызываемого метода, ожидаемые возвращаемые значения.
 
Получать и выполнять запросы из канала сообщений м.б. как один так и несколько объектов. К примеру имя персонального
 канала объекта (заропсы из которого выполняет только одина объект) - `@<имя объекта>`, имя канала для всех объектов
 тестового окружения `#platforms`. Для более подробной информации о каналах 
 см. раздел ['Система передача сообщений'](d3_6_messaging.md)
 
Выход из метода `transaction` осуществляется после того, как каждый объект, подтвердивший что выполнит запрос, вернёт 
успешный результат или информацю об ошибке.

Подробное опсание аргументов метода `transaction`:
* `channel` - имя канала сообщений, в который отправляется запрос, строка. 
* `message` - сообщение, содержащее информацию о вызываемом методе - имя интерфейс, имя метода, аргументы метожа
* `expected` - перечень (список) ожидаемых результатов выполнения. В перечень входят пары (в виде списков или кортежей),
 в каждой из которых первое значение (строка) - имя объекта, второе значение - ожидаемый результат выполнения из 
 следующих возможных на данный момент:
  * `success` или `s` для успешного выполнения
  * `false` или `f` для завершения выполнения с ошибкой

  В качестве имени объекта можно так же указывать следующие специальные значения:
  * `all` - означает, что все объекты должны вернуть указанный результат
  * `any` - означает, что хотя бы один объект должен вернуь указанный результат
  * `others` - означает, что объекты, не упомянутые в перечне, должны вернуть указанный результат
  * `none` - означает, что ни один объект не должен вернуть указанный результат

  Если значение `expected` не указано, подразумевается, что оно равно `[('all', 'success')]`, т.е. все объекты, 
  выполняющие этот метод должны выполнить его с успехом.

* `ignore` - перечень объектов, которые необходимо исключить при проверке ожидаемых результатов
* `more_info` - управляет возвращаемым результатом метода:
  * если `False` - то в качестве результата возвразщается `True` при совпадении всех результатов с ожидаемыми, 
  и `False` в противном случе
  * если `True` - то в качестве результата возвращается словарь со следующей структурой:
    * `result` - результат контроля проверки возвращаемых значений
    * `replies` - словарь с возвращёнными каждым объектом значениями, в котором ключ - имя объекта, значение -
     возвращённое этим объектом значение

  Этот аргумент следует указывать как `True` при необходимости детального контроля возвращаемых значений в функции 
тестирования.

## Связанность тестов и тестового окружения

Хотя и возможно использовать одно и тоже описание теста с несколькими тестовыми окружениями, тесты связаны с тестовым 
окружением:
* сутью проводимой проверки и соответственно наличием объектов абстракции сущностей определённого типа и определённой 
иерархии объектов тестового окружениия;
* объектами, взаимодействие с которыми проводится в тестах (связь на уровне имен этих объектов)
