# Применение методов формальной верификации

--TODO--
--На данном этапе только формируется спецификация осуществления формальной верификации фреймворком, и нет её реализации--
--В примере --...-- можно посмотреть ранний прототип такой верификации--

Использование фреймворка для осуществления проверок возможно и без применения формалной вериыикации, но именно её 
применение позволит получить ощутимый результат.

## Общий принцип

Для применения методов формальной верификации предлагается следующий прнцип:

Для сущности или группы сущностей даётся формальное описание принципов работы - набор возможных состояний и переходов
между ними посредством вызовов определённых методов.\
Для каждого из переходов указываются наборы допустимых вариантов аргументов метода, разбитые на множества, например если 
допустим аргумент в виде целого числа из диапазона `[min, max]`, где min < 0 и max > 0, то его можно для примера можно
разбить на следующие множества: `[min,min]`, `[min,-1]`, `[0,0]`, `[1, max-1]`, `[max,max]` для отдельной проверки 
граничных случаев, а так же для отдельной проверки некоторых специфичных значений, например зачения `0`.

Для каждого из переходов описывается протокол выполнения, т.е. что должно происходить на интерфейсе сущности или группы,
т.е. какое взаимодействие с другими сущностями должно происходить (если такое предполагается), какие результаты должны 
быть получены. В случае, если результат не может быть описан формально, описывается каким образом создать слепок 
состояния сущностей для последующей проверки человеком.

Данное описание будет использоваться сущностями `sequencer`, `coverage`, --`monitor`-- и `scoreboard` для формирования
воздействий и оценки коррректности реакции.

-- Формальное описание так же может быть использовано для анализа наличия недопустимых комбинаций параметров на входе 
чтобы повысить покрытие обработки исключительных ситуаций, продумать как это логично использовать, а так же посмотреть,
как это используют другие --

В одном тестовом окружении может быть в т.ч. всего одна сущность `sequencer`, формирующая воздействия на одну из 
проверяемых сущностей, при этом м.б. несколько сущностей `coverage` и `scoreboard`, контролирующих корректность работы 
различных сущностей текстового окружения.

## UVM-совемстимый формат формальнго описания

Сущности `sequencer`, `coverage` и `scoreboard` могут быть адаптированы для использования разных форматов формального
описания, но на данный момент предполагается что первый внедряемый формат будет использовать за основу UVM, т.к. эта
методология является сейчас ведущей в проверке кода RTL.

Это позволит опираться на проработанную методологию, позволит адаптироваться существующим специалистам и использовать
существующие наработки.

-- Возможно получится абстрагировать формат описания от реализации этих сущсностей в специальной сущности `rules`--

## Подробнее о сущностях формальной верификации

-- Требует сверки с тем, что есть в UVM --
-- Информация дана в кратце --

### Rules

Данная сущность принимает формальное описание в одном из форматов и формирует данные для других сущностей формальной
верификации (`coverage` и `scoreboard`)

### Coverage

Содержит информацию о возможных состояниях и переходах связанной проверяемой сущности (или группы) , и осуществляет учёт
того, какие и сколько раз уже были покрыты за время проверки посредством анализа принимаемых ими, а так же посредством
анализа слепков их состояния (с учётом этого в т.ч. рапсполагает информацией о текущем состоянии).\
Для этого в данной сущности заложены правила сопоставления получаемой информации о работе сущности с формильным 
описанием.

Может сохранять и загружать информацию о покрытии, что позволяет разбить выполнение проверки во времени, распределить
её между исполнителями, а так же в принципе разбить её на несколько вариантов тестового окружения.


### Scoreboard

Осуществляет контроль корректности выполнения методов связанной проверяемой сушности (или группы) посредством анализа 
принимаемых ими и выдаваемых ими сообщений, а так же посредством анализа слепков их состояния.\
Для этого в данной сущности заложены правила сопоставления получаемой информации о работе сущности с формильным 
описанием.

В процессе контроля осуществялет пометку переходов, приводящих к ошибкам, и формирует быллы результата проверки.

Может сохранять и загружать накопленную информацию, что позволяет накапливать информацию распределённых во времмени
проверок, а так же получать информацию от проверок, выполненнымии другими исполнителями.

При обнаружении ошибки может влиять на выполнение проверки для перевода тестового окружения и проверяемой сущности в
исходное сосотояние.

### Sequencer

Формирует воздействия для покрытия необходимых состояний и переходов. Основное преимущество этой сущности в сочетании с
соответсующей сущностью `coverage` - получая от неё текущее состояние, какие переходы и состояния нужно покрыть, и на
основе формального описания формирует последовательности воздейсвий чтобы обеспечить полное покрытие.

Кроме этого от соовтетвующей сущности `scoreboard` она может получать информацию о переходах, которые приводят к ошибке,
и избегать их при формировании последовательностей воздействий.

В параметрах этой сущности может быть указано минимальное требуемое количество покрытий переходов для завершения 
проверки, а так же параметры, влияющие на выбор очередного воздействия и значений аргументов из нескольких возможных 
закономерным образом или псевдослучайным, но при этом повторно воспроизводимым.

Действия сущности могут координироваться --внешним супервизором--, позволяющим распределить проверку между исполнителями,
а так же в принципе разбить её на несколько вариантов тестового окружения.

В сложных случаях одна сущность `sequencer` может формировать воздействия для управления другими сущносятми `sequencer`.

Кроме формирования воздействий на основании информации о покрытии, для воспроизведения случая ошибки формируемая 
во время проверки последовательность воздействий записывается и м.б. воспроизведена этой сущнстью с определённого места.

## Принцип описания тестового окружения и проведения проверок при использовании формальной вериикации

-- TODO --
-- Приведённая информация вкратце описывает идею --

Формальные правила задаются одним из следующих образов:
* описываются явно в параметрах сущности `rules` в описании тестового окружения
* в отдельных классах Python, экспортирующих эти правила, а из какого класса импортируются правила указывается в 
параметре сущности `rules`.

В описании тестового окружения яыным или не яывнм образом к проверяемой сущности (или группе) добавляются сущности
`rules`, `coverage` и `scoreboard` и связываются с ней.

В описании тестового окружения добавляется одна или несколько сущностей `sequencer`, которые будут формировать
воздействия для проведения проверки. Эти сущности могут быть отклчаемыи для возможности использования данного
тестового окружения как часть другого окружения но без самостоятельно формирования тестовых воздействий.

Воздействия при формальной верификации формируются исключительно сущностями `sequencer`. При запуске проверки можно 
задать параметры их работы.

## Информация о собираемых данных во время првоерки

* --Журнал сообщений--

Во время время выполениня проверки осуществляется журналирование всех передаваемых сообщений. В последствии их можно 
посмотреть в текстовом виде а так же в виде UML диаграммы (данные формируются в формате PlantUML). Журнал может быть 
разбит по фазам проверки - по запускам определённых тестов а так же по воздействиям, формируемым сущностями 
типа `sequencer`.

* --Слепки состояний--

Помимо сообщений возможен просмотр --слепков состояний-- сущностей, осуществляемых при выполнении тестов или при работе
компонентов формальной верификации.
